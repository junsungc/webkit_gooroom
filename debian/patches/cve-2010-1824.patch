Description: fix cve-2010-1824
Author: Michael Gilbert <michael.s.gilbert@gmail.com>
Origin: http://trac.webkit.org/changeset/66795
Index: webkit/WebCore/svg/SVGUseElement.cpp
===================================================================
--- webkit.orig/WebCore/svg/SVGUseElement.cpp	2010-11-14 17:07:47.000000000 -0500
+++ webkit/WebCore/svg/SVGUseElement.cpp	2010-11-14 17:07:54.000000000 -0500
@@ -122,14 +123,14 @@
 {
     // This functions exists to assure assumptions made in the code regarding SVGElementInstance creation/destruction are satisfied.
     SVGElement::insertedIntoDocument();
-    ASSERT(!m_targetElementInstance);
+    ASSERT(!m_targetElementInstance || ((document()->isSVGDocument() || document()->isXHTMLDocument()) && !static_cast<Document*>(document()->parser())->wellFormed()));
     ASSERT(!m_isPendingResource);
 }
 
 void SVGUseElement::removedFromDocument()
 {
+    SVGStyledTransformableElement::removedFromDocument();
     m_targetElementInstance = 0;
-    SVGElement::removedFromDocument();
 }
 
 void SVGUseElement::svgAttributeChanged(const QualifiedName& attrName)
@@ -572,8 +573,8 @@
 
 void SVGUseElement::detach()
 {
-    m_targetElementInstance = 0;
     SVGStyledTransformableElement::detach();
+    m_targetElementInstance = 0;
 }
 
 static bool isDirectReference(Node* n)
