description: fix cve-2010-1416
author: Michael Gilbert <michael.s.gilbert@gmail.com>
origin: http://trac.webkit.org/changeset/56810
Index: webkit-1.2.1/WebCore/html/canvas/CanvasRenderingContext2D.cpp
===================================================================
--- webkit-1.2.1.orig/WebCore/html/canvas/CanvasRenderingContext2D.cpp	2010-05-13 16:31:30.000000000 -0400
+++ webkit-1.2.1/WebCore/html/canvas/CanvasRenderingContext2D.cpp	2010-06-28 21:12:50.000000000 -0400
@@ -1211,7 +1211,7 @@
     if (!cachedImage || !image->cachedImage()->image())
         return CanvasPattern::create(Image::nullImage(), repeatX, repeatY, true);
 
-    bool originClean = !canvas()->document()->securityOrigin()->taintsCanvas(KURL(KURL(), cachedImage->url()));
+    bool originClean = !canvas()->document()->securityOrigin()->taintsCanvas(KURL(KURL(), cachedImage->url())) && cachedImage->image()->hasSingleSecurityOrigin();
     return CanvasPattern::create(cachedImage->image(), repeatX, repeatY, originClean);
 }
 
