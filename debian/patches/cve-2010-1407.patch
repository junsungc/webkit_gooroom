description: fix cve-2010-1407
author: Michael Gilbert <michael.s.gilbert@gmail.com>
origin: http://trac.webkit.org/changeset/56365
Index: webkit-1.2.1/WebCore/loader/HistoryController.cpp
===================================================================
--- webkit-1.2.1.orig/WebCore/loader/HistoryController.cpp	2010-05-13 16:31:30.000000000 -0400
+++ webkit-1.2.1/WebCore/loader/HistoryController.cpp	2010-06-28 21:08:29.000000000 -0400
@@ -656,15 +656,17 @@
 
 void HistoryController::replaceState(PassRefPtr<SerializedScriptValue> stateObject, const String& title, const String& urlString)
 {
-    Page* page = m_frame->page();
-    ASSERT(page);
-    HistoryItem* current = page->backForwardList()->currentItem();
-    ASSERT(current);
+    // FIXME: We should always have m_currentItem here!!
+    // https://bugs.webkit.org/show_bug.cgi?id=36464
+    if (!m_currentItem) {
+        ASSERT_NOT_REACHED();
+        return;
+    }
 
     if (!urlString.isEmpty())
-        current->setURLString(urlString);
-    current->setTitle(title);
-    current->setStateObject(stateObject);
+        m_currentItem->setURLString(urlString);
+    m_currentItem->setTitle(title);
+    m_currentItem->setStateObject(stateObject);
 }
 
 } // namespace WebCore
