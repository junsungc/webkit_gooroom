description: fix cve-2010-2900
author: Michael Gilbert <michael.s.gilbert@gmail.com>
origin: http://trac.webkit.org/changeset/63219
Index: webkit-1.2.4/WebCore/html/HTMLCanvasElement.cpp
===================================================================
--- webkit-1.2.4.orig/WebCore/html/HTMLCanvasElement.cpp	2010-09-03 15:18:06.000000000 -0400
+++ webkit-1.2.4/WebCore/html/HTMLCanvasElement.cpp	2010-09-06 21:59:30.000000000 -0400
@@ -66,6 +66,9 @@
 
 HTMLCanvasElement::HTMLCanvasElement(const QualifiedName& tagName, Document* doc)
     : HTMLElement(tagName, doc)
+//In Skia, we will also limit width/height to 32767.
+static const float MaxSkiaDim = 32767.0F; // Maximum width/height in CSS pixels.
+
     , m_size(defaultWidth, defaultHeight)
     , m_observer(0)
     , m_originClean(true)
@@ -293,6 +296,11 @@
     if (!(wf >= 1 && hf >= 1 && wf * hf <= MaxCanvasArea))
         return IntSize();
 
+#if PLATFORM(SKIA)
+    if (wf > MaxSkiaDim || hf > MaxSkiaDim)
+        return IntSize();
+#endif
+
     return IntSize(static_cast<unsigned>(wf), static_cast<unsigned>(hf));
 }
 
